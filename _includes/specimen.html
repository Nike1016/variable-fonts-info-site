{% assign params = include.params|default:include %}

{% assign nicefont = params.font|default:"Amstelvar-Alpha" %}

{% if site.data.fonts.axes[nicefont] %}
    {% assign fontfamily = nicefont %}
{% elsif site.data.fonts.names[nicefont] %}
    {% assign fontfamily = site.data.fonts.names[nicefont] %}
{% else %}
    {% assign fontfamily = "AmstelvarAlpha-VF" %}
{% endif %}

{% assign allaxes = site.data.fonts.axes[fontfamily] %}

{% assign fontsize = params.size|default:72|abs %}

{% if params.leading %}
    {% if params.leading < 6 %}
        {% assign lineheight = fontsize|times:params.leading %}
    {% else %}
        {% assign lineheight = params.leading|abs %}
    {% endif %}
{% else %}
    {% assign lineheight = fontsize %}
{% endif %}

{% assign layout = params.layout|default:"single-line" %}

{% assign fvs_verbose = site.emptyArray %}
{% assign fvs = site.emptyArray %}

{% for kv in allaxes %}
    {% assign tag = kv[0] %}
    {% assign axis = kv[1] %}
    {% assign tagsize = tag|size %}
    {% if tagsize == 4 %}
        {% if params.axes[tag] %}
            {% capture fvsentry %}"{{tag}}" {{params.axes[tag]}}{% endcapture %}
            {% assign fvs = fvs|push:fvsentry %}
            {% assign fvs_verbose = fvs_verbose|push:fvsentry %}
        {% else %}
            {% capture fvsentry %}"{{tag}}" {{axis.default}}{% endcapture %}
            {% assign fvs_verbose = fvs_verbose|push:fvsentry %}
        {% endif %}
    {% endif %}
{% endfor %}

<figure class='specimen {{layout}}' style='font-family:"{{fontfamily}}";font-size:{{fontsize}}px;line-height:{{lineheight}}px;font-variation-settings:{{fvs_verbose|join:","}};'>
    {{params.text|default:"Example"}}
    <figcaption>
        <ul class='axes'>
            <li>{{fvs|join:"</li><li>"|replace:'"':''}}</li>
        </ul>
    </figcaption>
</figure>
